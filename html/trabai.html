<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="../css/main.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="  crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <title>Trắc nghiệm</title>
</head>
<body>
<header>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">
                <img src="../images/logo.png" width="50" height="50" style="border-radius: 50%">
            </a>
            <button
                    class="navbar-toggler"
                    type="button"
                    data-mdb-toggle="collapse"
                    data-mdb-target="#navbarExample01"
                    aria-controls="navbarExample01"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
            >
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarExample01">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item active">
                        <a class="nav-link" aria-current="page" href="home.html" style="font-size: 20px">Home</a>
                    </li>
                    <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
                        <ul class="navbar-nav">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 20px">
                                    Học tập
                                </a>
                                <ul class="dropdown-menu dropdown-menu" aria-labelledby="navbarDarkDropdownMenuLink">
                                    <li><a class="dropdown-item" href="tailieu.html">Tài liệu</a></li>
                                    <li><a class="dropdown-item" href="tracnghiem.html">Trắc nghiệm</a></li>
                                    <li><a class="dropdown-item" href="donggop.html">Đóng góp tài liệu</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <li class="nav-item">
                        <a class="nav-link" href="#" style="font-size: 20px">Về chúng tôi</a>
                    </li>
                </ul>
                <form class="d-flex" method="get" action="tracnghiem.html">
                    <input class="form-control" type="search" name="text" placeholder="Search" aria-label="Search">
                </form>
                <button  id="login" type="button" class="btn btn-outline-secondary ms-4 d-none" data-bs-toggle="modal" data-bs-target="#modal-login">Login</button>
                <div id="login-spinner" class="spinner-border text-light ms-3" role="status"></div>
                <div class="dropdown" style="right: 0">
                    <a href="#user-signed-in"><img id="avatar"  src="../images/user.svg" data-bs-toggle="dropdown" width="38x" height="38x"
                                                   class="user avatar rounded-circle ms-3 d-none dropdown-toggle"></a>
                    <ul class="dropdown-menu dropdown-menu-center text-small" aria-labelledby="dropdownUser1" style="right: 0">

                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modal-login">Profile</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="#" onclick="firebase.auth().signOut();">Sign out</a></li>
                    </ul>
                </div>
                <div class="modal fade d-block1" id="modal-login" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg" >
                        <div class="modal-content shadow">
                            <div class="modal-header">
                                <h3 class="modal-title">Login</h3>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div id="" class="guest">
                                    <div class="container-1">
                                        <form action="/">
                                            <div id="firebaseui-auth-container"></div>

                                            <div class="d-flex justify-content-center pt-3" style="font-size: 30px; color: gray">
                                                OR
                                            </div>

                                            <div class="pt-3">
                                                <input class="input" type="text" name="username" placeholder="Username" required>
                                                <input class="input" type="password" name="password" placeholder="Password" required>
                                                <input class="input" type="submit" value="Login">
                                            </div>

                                        </form>
                                    </div>
                                </div>
                                <div id="user-signed-in" class="d-none d-flex user">
                                    <div class="flex-grow-1 d-flex justify-content-center">
                                        <img  src="../images/user.svg" width="110px" height="110px" class="avatar rounded-circle">
                                    </div>
                                    <div class="flex-grow-1  d-flex flex-column align-self-center me-4">
                                        <div id="name" class="align-self-center text-primary fs-5">Name</div>
                                        <div id="email" class="align-self-center ">Email</div>
                                        <div id="phone">Phone</div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer d-none user">
                                <button id="sign-out" type="button" class="btn btn-danger" onclick="firebase.auth().signOut();">Sign out</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <nav id="myHeader" class="navbar navbar-expand-md navbar-dark bg">
        <div class="container container-fluid">
            <div style="font-size: 30px; color: white;" id="subjectName"></div>
            <div class="d-flex justify-content-end" style="font-size: 20px; color: white;">00:00</div>
        </div>
    </nav>
</header>

<main>
    <div class="main2">
        <form name="myform" id='testform' method="post" action="http://localhost:8080/api/objectivetest/check">
            <div id="Title1" class="content-nb">
            </div>
        </form>
    </div>
    <div class="card shadow-0 border mt-5" style="background-color: #f0f2f5;">
        <div class="card-body p-4" id="comment">

        </div>
    </div>


<!--    <div class="card shadow-0 border mt-5" style="background-color: #f0f2f5;">-->
<!--        <div class="container mb-5 mt-5">-->
<!--            <div class="card1">-->
<!--                <div class="row">-->
<!--                    <div class="col-md-12">-->
<!--                        <h3 class="text-center mb-5"> Comments </h3>-->
<!--                        <div class="row">-->
<!--                            <div class="col-md-12">-->
<!--                                <div class="media"> <img class="mr-3 rounded-circle" alt="Bootstrap Media Preview" src="https://i.imgur.com/stD0Q19.jpg" />-->
<!--                                    <div class="media-body">-->
<!--                                        <div class="row">-->
<!--                                            <div class="col-8 d-flex">-->
<!--                                                <h5>Maria Smantha</h5> <span>- 2 hours ago</span>-->
<!--                                            </div>-->
<!--                                            <div class="col-4">-->
<!--                                                <div class="pull-right reply"> <a href="#"><span><i class="fa fa-reply"></i> reply</span></a> </div>-->
<!--                                            </div>-->
<!--                                        </div> It is a long established fact that a reader will be distracted by the readable content of a page. <div class="media mt-4"> <a class="pr-3" href="#"><img class="rounded-circle" alt="Bootstrap Media Another Preview" src="https://i.imgur.com/xELPaag.jpg" /></a>-->
<!--                                        <div class="media-body">-->
<!--                                            <div class="row">-->
<!--                                                <div class="col-12 d-flex">-->
<!--                                                    <h5>Simona Disa</h5> <span>- 3 hours ago</span>-->
<!--                                                </div>-->
<!--                                            </div> letters, as opposed to using 'Content here, content here', making it look like readable English.-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                        <div class="media mt-3"> <a class="pr-3" href="#"><img class="rounded-circle" alt="Bootstrap Media Another Preview" src="https://i.imgur.com/nAcoHRf.jpg" /></a>-->
<!--                                            <div class="media-body">-->
<!--                                                <div class="row">-->
<!--                                                    <div class="col-12 d-flex">-->
<!--                                                        <h5>John Smith</h5> <span>- 4 hours ago</span>-->
<!--                                                    </div>-->
<!--                                                </div> the majority have suffered alteration in some form, by injected humour, or randomised words.-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--&lt;!&ndash;                                <div class="media mt-4"> <img class="mr-3 rounded-circle" alt="Bootstrap Media Preview" src="https://i.imgur.com/xELPaag.jpg" />&ndash;&gt;-->
<!--&lt;!&ndash;                                    <div class="media-body">&ndash;&gt;-->
<!--&lt;!&ndash;                                        <div class="row">&ndash;&gt;-->
<!--&lt;!&ndash;                                            <div class="col-8 d-flex">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <h5>Shad f</h5> <span>- 2 hours ago</span>&ndash;&gt;-->
<!--&lt;!&ndash;                                            </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                            <div class="col-4">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <div class="pull-right reply"> <a href="#"><span><i class="fa fa-reply"></i> reply</span></a> </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                            </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                        </div> The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33. <div class="media mt-4"> <a class="pr-3" href="#"><img class="rounded-circle" alt="Bootstrap Media Another Preview" src="https://i.imgur.com/nUNhspp.jpg" /></a>&ndash;&gt;-->
<!--&lt;!&ndash;                                        <div class="media-body">&ndash;&gt;-->
<!--&lt;!&ndash;                                            <div class="row">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <div class="col-12 d-flex">&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <h5>Andy flowe</h5> <span>- 5 hours ago</span>&ndash;&gt;-->
<!--&lt;!&ndash;                                                </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                            </div> Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin commodo. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis.&ndash;&gt;-->
<!--&lt;!&ndash;                                        </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                    </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                        <div class="media mt-3"> <a class="pr-3" href="#"><img class="rounded-circle" alt="Bootstrap Media Another Preview" src="https://i.imgur.com/HjKTNkG.jpg" /></a>&ndash;&gt;-->
<!--&lt;!&ndash;                                            <div class="media-body">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <div class="row">&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <div class="col-12 d-flex">&ndash;&gt;-->
<!--&lt;!&ndash;                                                        <h5>Simp f</h5> <span>- 5 hours ago</span>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                                </div> a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur&ndash;&gt;-->
<!--&lt;!&ndash;                                            </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                        </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                        <div class="media mt-3"> <a class="pr-3" href="#"><img class="rounded-circle" alt="Bootstrap Media Another Preview" src="https://i.imgur.com/nAcoHRf.jpg" /></a>&ndash;&gt;-->
<!--&lt;!&ndash;                                            <div class="media-body">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <div class="row">&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <div class="col-12 d-flex">&ndash;&gt;-->
<!--&lt;!&ndash;                                                        <h5>John Smith</h5> <span>- 4 hours ago</span>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                                </div> the majority have suffered alteration in some form, by injected humour, or randomised words.&ndash;&gt;-->
<!--&lt;!&ndash;                                            </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                        </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                    </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                </div>&ndash;&gt;-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
    <script>
        window.onscroll = function() {myFunction()};

        var header = document.getElementById("myHeader");
        var sticky = header.offsetTop;
        const urlSearchParams = new URLSearchParams(window.location.search);
        const params = Object.fromEntries(urlSearchParams.entries());
        console.log(params)
        let testresult = sessionStorage.getItem("testresult")
        console.log(testresult)

        function myFunction() {
            if (window.pageYOffset > sticky) {
                header.classList.add("sticky");
            } else {
                header.classList.remove("sticky");
            }
        }

        $.ajax({
            "url": "http://localhost:8080/api/objectivetest/check",
            "method": "POST",
            "data": params,
        }).done(function (response) {
            let testresult = response;
            sessionStorage.setItem("testresult", testresult);
            console.log(response)
            $("#Title1").empty()
            $("#Title1").append("<h1>"+testresult.testName+"</h1><h2>Trả bài</h2><br><div style='color: green'><h3>Điểm của bạn là: "+testresult.score+"/"+testresult.totalScore+"</h3></div>")
            distance=testresult.dotime;
            var minutes = Math.floor((distance / (1000 * 60)));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);
            var dotime = ""
            if(minutes>0) dotime = minutes + " phút";
            if(seconds>0) dotime = dotime + " " + seconds +" giây";
            if(testresult.time>0)
                $("#Title1").append("<div style='color: green'><h3>Thời gian làm bài: "+dotime+"/"+testresult.time+" phút</h3></div>")
            $("#Title1").append("<br>");

            jQuery.each(testresult.formAnswerList, function (i, val) {
                let q=val.question;
                let num = i + 1;
                let answers = q.answers;
                let title = q.title;
                if (/^\d*./.test(q.title))
                    title = q.title.substring(q.title.indexOf(".") + 1).trim();
                if (/^Câu \d*:/.test(val.title))
                    title = q.title.substring(q.title.indexOf(":") + 1).trim();
                $("#Title1").append("<div id='question_" + num + "'><b>"
                    + num + ". " + title+"</b>")
                $("#Title1").append("<input type='hidden' name='" + "qid_" + num + "' value='"+q.id+"'></input>")
                if (q.image != null)
                    $("#Title1").append("<img src='" + q.image + "'></img> <br>")
                jQuery.each(answers, function (a_i, a_val) {
                    $("#Title1").append("<div id='text_answer_" + num + "_"+a_val.answerHead+"'>" + a_val.answer + "<div>")
                })
                if(val.answerHead!='.'){
                    if(val.check) document.getElementById("text_answer_" + num + "_"+val.answerHead).style.color='blue';
                    else document.getElementById("text_answer_" + num + "_"+val.answerHead).style.color='red';
                }
                $("#Title1").append("<div id='result_"+num+"'></div> <div id='solution_"+num+"' style='color: grey'></div> <div id='feedback_"+num+"' style='color: yellow'></div> </p> <br> </div>")
                if(val.check){
                    $("#result_"+num).append("Đúng");
                    document.getElementById("result_"+num).style.color='blue';
                }
                else{
                    $("#result_"+num).append("Sai");
                    document.getElementById("result_"+num).style.color='red';
                    if(q.solution!=null)
                        $("#solution_"+num).append("Câu trả lời đúng là: <br>"+q.solution);
                }
                if(q.feedback!=null){
                    $("#feedback_"+num).append("Phản hồi: <br>"+q.feedback);
                }
            })

            let redo="tracnghiem2.html";
            redo=redo+"?sbjid="+params.sbjid;
            redo=redo+"&testName="+params.testName;
            $('#Title1').append("<div class='d-flex justify-content-center align-items-center pt-2'>\n" +
                "                <button class='btn btn-outline-primary' type='button' onclick='window.location.replace(\""+redo+"\")' style='border-radius: 27px;'>Làm lại</button>\n" +
                "            </div>")
            alert("Trả bài");


            $.ajax({
                url: "http://localhost:8080/api/comment?id=" + params.objectiveTestId,
                type: "GET"
            }).done(function (data) {
                let comments = data;
                console.log("list.length = " + comments.length)
                console.log(comments)
                $("#comment").append("<h5 class=\"mb-4\"> Comments (<span>" + comments.length + "</span>)</h5>"
                    + "<form class=\"d-flex user d-none\" method=\"post\" action='#'>\n" +
                    "                    <div class=\"flex-grow-1\"><input type=\"text\" class=\"form-control\" name=\"comment\" placeholder=\"Comment\"/></div>\n" +
                    "                    </div>\n" +
                    "                </form>" +
                    "           <div class=\"form-outline mb-4\">\n" +
                    "                <form class=\"d-flex user d-none\" method=\"post\" th:action=\"http://localhost:8080/api/comment/add\">\n" +
                    "                    <input type=\"hidden\" th:value=\""+params.objectiveTestId+"\" name=\"objectiveTest_id\"/>\n" +
                    "                    <div class=\"flex-grow-1\"><input type=\"text\" class=\"form-control\" name=\"comment\" placeholder=\"Comment\"/></div>\n" +
                    "                    <div class=\"ps-2\">\n" +
                    "                        <button class=\"btn btn-outline-success\" type=\"submit\">Send</button>\n" +
                    "                    </div>\n" +
                    "                </form>\n" +
                    "                <div class=\"text-center guest\">You must be <a href=\"#\" data-bs-toggle=\"modal\" data-bs-target=\"#modal-login\">logged in</a> to post a comment.</div>\n" +
                    "            </div>")
                jQuery.each(comments, function (i, val) {
                    $("#comment").append(
                        "            <div class=\"card\">\n" +
                        "                <div class=\"card-body\">\n" +
                        "                    <div class=\"d-flex\">\n" +
                        "                        <img src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/User_icon_2.svg/220px-User_icon_2.svg.png\" alt=\"avatar\" width=\"40\" height=\"40\"/>\n" +
                        "                        <div class=\"d-flex flex-column \">\n" +
                        "                            <p class=\"small m-0 ms-2\"><span>" + val.name + "</span></p>\n" +
                        "                            <p class=\"small m-0 ms-2 text-muted\"><span>" + val.email + "</span></p>\n" +
                        "                        </div>\n" +
                        "                        <div class=\"flex-grow-1 text-end small m-0 ms-2 text-muted\"><span>" + val.timeAgo + "</span></div>\n" +
                        "                    </div>\n" +
                        "\n" +
                        "                    <div class=\"mt-2\"><span>" + val.text + "</span></div>\n" +
                        "\n" +
                        "                </div>\n" +
                        "            </div> <hr>");
                })
            }).fail(function (xhr, status, errorThrown) {
                $("#title").html("Sorry, there was a problem!")
            })
        });
    </script>
</main>

<footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
    <script src="../../js/main.js"></script>
</footer>
</body>
</html>