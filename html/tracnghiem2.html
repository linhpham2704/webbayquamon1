<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">
    <link href="../css/main.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="  crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Trắc nghiệm</title>
</head>
<body>
<header>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">
                <img src="../images/logo.png" width="50" height="50" style="border-radius: 50%">
            </a>
            <button
                    class="navbar-toggler"
                    type="button"
                    data-mdb-toggle="collapse"
                    data-mdb-target="#navbarExample01"
                    aria-controls="navbarExample01"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
            >
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarExample01">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item active">
                        <a class="nav-link" aria-current="page" href="home.html" style="font-size: 20px">Home</a>
                    </li>
                    <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
                        <ul class="navbar-nav">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 20px">
                                    Học tập
                                </a>
                                <ul class="dropdown-menu dropdown-menu" aria-labelledby="navbarDarkDropdownMenuLink">
                                    <li><a class="dropdown-item" href="tailieu.html">Tài liệu</a></li>
                                    <li><a class="dropdown-item" href="tracnghiem.html">Trắc nghiệm</a></li>
                                    <li><a class="dropdown-item" href="donggop.html">Đóng góp tài liệu</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <li class="nav-item">
                        <a class="nav-link" href="#" style="font-size: 20px">Về chúng tôi</a>
                    </li>
                </ul>
                <form class="d-flex" method="get" action="/">
                    <input class="form-control" type="search" name="text" placeholder="Search" aria-label="Search">
                </form>
                <button id="login" type="button" class="btn btn-outline-secondary ms-4" data-bs-toggle="modal" data-bs-target="#modal-login">Login</button>
                <div class="dropdown">
                    <img id="avatar"  src="../images/user.svg" data-bs-toggle="dropdown" width="38x" height="38x"
                         class="user avatar rounded-circle ms-3 d-none dropdown-toggle">
                    <ul class="dropdown-menu dropdown-menu-center text-small" aria-labelledby="dropdownUser1">
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modal-login">Profile</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="#" onclick="firebase.auth().signOut();">Sign out</a></li>
                    </ul>
                </div>
                <div class="modal fade d-block1" id="modal-login" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content shadow">
                            <div class="modal-header">
                                <h3 class="modal-title">Login</h3>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div id="" class="guest">
                                    <div class="container-1">
                                        <form action="/">
                                            <div class="row">
                                                <div>
                                                    <a href="#" class="fb btn4">
                                                        <i class="fa fa-facebook fa-fw"></i> Login with Facebook
                                                    </a>
                                                    <a href="#" class="twitter btn4">
                                                        <i class="fa fa-twitter fa-fw"></i> Login with Twitter
                                                    </a>
                                                    <a href="#" class="google btn4"><i class="fa fa-google fa-fw">
                                                    </i> Login with Google+
                                                    </a>
                                                </div>

                                                <div class="d-flex justify-content-center pt-3" style="font-size: 30px; color: gray">
                                                    OR
                                                </div>

                                                <div class="pt-3">
                                                    <input class="input" type="text" name="username" placeholder="Username" required>
                                                    <input class="input" type="password" name="password" placeholder="Password" required>
                                                    <input class="input" type="submit" value="Login">
                                                </div>

                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div id="user-signed-in" class="d-none d-flex user">
                                    <div class="flex-grow-1 d-flex justify-content-center">
                                        <img  src="../images/user.svg" width="110px" height="110px" class="avatar rounded-circle">
                                    </div>
                                    <div class="flex-grow-1  d-flex flex-column align-self-center me-4">
                                        <div id="name" class="align-self-center text-primary fs-5">Name</div>
                                        <div id="email" class="align-self-center ">Email</div>
                                        <div id="phone">Phone</div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer d-none user">
                                <button id="sign-out" type="button" class="btn btn-danger" onclick="firebase.auth().signOut();">Sign out</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <nav id="myHeader" class="navbar navbar-expand-md navbar-dark bg">
        <div class="container container-fluid">
            <div style="font-size: 30px; color: white;" id="subjectName"></div>
            <div class="d-flex justify-content-end" style="font-size: 20px; color: white;">00:00</div>
        </div>
    </nav>
    <nav>
        <div class="tab-tn">
<!--            <button class="tablinks" onclick="" id="defaultOpen">Tổng hợp 1</button>-->
<!--            <button class="tablinks" onclick="">Title 2</button>-->
        </div>
    </nav>
    <!-- Navbar -->
</header>
<main>
    <div class="main">
        <form name="myform" id='testform' method="post" action="http://localhost:8080/api/objectivetest/check">
        <div id="Title1" class="content-tn">

        </div>
        </form>

        <div id="Title2" class="content-tn">
<!--            <h1>Title</h1>-->
        </div>
    </div>

    <script>
        window.onscroll = function() {myFunction()};
        let url = $(location)[0].href;
        var header = document.getElementById("myHeader");
        var sticky = header.offsetTop;
        const urlSearchParams = new URLSearchParams(window.location.search);
        const params = Object.fromEntries(urlSearchParams.entries());
        console.log(params)

        function myFunction() {
            if (window.pageYOffset > sticky) {
                header.classList.add("sticky");
            } else {
                header.classList.remove("sticky");
            }
        }

        function openTitle(evt, til) {
            console.log(evt+til)
            var i, contenttn, tablinks;
            contenttn = document.getElementsByClassName("content-tn");
            for (i = 0; i < contenttn.length; i++) {
                contenttn[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById("Title1").style.display = "block";
            $.ajax({
                url: "http://localhost:8080/api/objectivetest?id=" + til,
                type: "GET"
            }).done(function (data) {
                let objecques = data;
                console.log(objecques)
                $("#Title1").empty()
                $("#Title1").append("<input type='hidden' name='testName' value='"+objecques.testName+"'></input>" +
                    "<input type='hidden' name='objectiveTestId' value='"+objecques.objectiveTestId+"'></input>")
                jQuery.each(objecques.questions, function (i, val) {
                    let num = i + 1;
                    let answers = val.answers;
                    let title = val.title;
                    if (/^\d*./.test(val.title))
                        title = val.title.substring(val.title.indexOf(".") + 1).trim();
                    if (/^Câu \d*:/.test(val.title))
                        title = val.title.substring(val.title.indexOf(":") + 1).trim();
                    $("#Title1").append("<div id='question_" + num + "'>"
                        + num + ". " + title)
                    $("#Title1").append("<input type='hidden' name='" + "qid_" + num + "' value='"+val.id+"'></input>")
                    if (val.image != null)
                        $("#Title1").append("<img src='" + val.image + "'></img> <br>")
                    jQuery.each(answers, function (a_i, a_val) {
                        $("#Title1").append("<input type='radio' name='" + "answer_" + num + "' id='" + "answer_" + num + "_"+a_val.answerHead+"' value='"+a_val.answer+"'>" + a_val.answer + "</input> <br>")
                    })

                    $("#Title1").append("</p> <br> </div>")
                })
                $('#Title1').append("<div class='d-flex justify-content-center align-items-center pt-2'>\n" +
                    "                <button class='btn btn-outline-primary' type='button' onclick='check()' style='border-radius: 27px;'>Nộp bài</button>\n" +
                    "            </div>")
            })
            evt.currentTarget.className += " active";
        }


        function check()
        {
            var formData = new FormData(document.getElementById('testform'))
            var formDataEntries = formData.entries()
            var postdata=url.substring(url.indexOf("?")+1);
            let f = formDataEntries.next();
            while (!f.done) {
                postdata=postdata+"&"+f.value[0]+"="+f.value[1];
                f = formDataEntries.next();
            }
            console.log(postdata)

            alert("Đã nộp bài")
            window.location.replace("trabai.html?"+postdata);
        }
        $.ajax({
            url: "http://localhost:8080/api/subject?id=" + params.sbjid,
            type: "GET"
        }).done(function (data) {
            let subject= data;
            console.log(subject)
            $("#subjectName").append(subject.name);
            first=true
            jQuery.each(subject.objectiveTest_name_id, function (i,val){
                if(first){
                    $(".tab-tn").append("<button class=\"tablinks\" onclick=\"openTitle(event,"+val+")\" id='defaultOpen' value='"+i+"'>"+i+"</button>")
                    // Get the element with id="defaultOpen" and click on it
                    first=false
                }
                else{
                    $(".tab-tn").append("<button class=\"tablinks\" onclick=\"openTitle(event,"+val+")\" id='"+i+"' value='"+i+"'>"+i+"</button>")
                }
            })
            defaultTestName=document.getElementById("defaultOpen").getAttribute("value")
            if(params.testName==defaultTestName | params.testName==null)
                document.getElementById("defaultOpen").click()
            else
                document.getElementById(params.testName).click()
        })
    </script>
</main>

<footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
    <script src="../../js/main.js"></script>
</footer>
</body>
</html>